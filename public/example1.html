
<html>
    <head>
    <script src="/__/firebase/7.20.0/firebase-app.js"></script>
    <script src="/__/firebase/7.20.0/firebase-auth.js"></script>
    <script src="/__/firebase/7.20.0/firebase-firestore.js"></script>

    <script src="/__/firebase/init.js"></script>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
        <script type="text/javascript">
          const db = firebase.firestore();
          google.charts.load('current', {packages: ['corechart']});

          db.collection('devices').orderBy('deviceName').onSnapshot(snapshot =>{
            var Devices = db.collection("devices").doc('jya8XdUSmvrRehqk7t4c');
            Devices.get().then(function(doc){
                if (doc.exists) {
                    var devicedata = doc.data();
                    var deviceName = devicedata.deviceName;
                    var CurrentTemperature = devicedata.CurrentTemperature;
                    var CurrentHumidity = devicedata.CurrentHumidity;
                    var Tempdata = devicedata.Temperature;
                    var Humiddata = devicedata.Humidity;
                    var Timedata = devicedata.SampleTimes;
                    var samplenum = Tempdata.length;
                    var tempRows = [[0,0]]
                    var humidRows = [[0,0]]
                    for(var i = 0; i < samplenum; i++){
                        tempRows[i] = [Timedata[i],parseInt(Tempdata[i],10)];
                        humidRows[i] = [Timedata[i],parseInt(Humiddata[i],10)];
                    }

                    document.getElementById("device_Name").innerHTML = "Device Name: " + deviceName;
                    document.getElementById("Current_Temperature").innerHTML = "Current Temperature: " + CurrentTemperature + "Â°F";
                    document.getElementById("Current_Humidity").innerHTML = "Current Humidity: " + CurrentHumidity + "%";

                    var tempGraphData = new google.visualization.DataTable();
                    tempGraphData.addColumn('string', 'Time');
                    tempGraphData.addColumn('number', 'Temperature');

                    tempGraphData.addRows(tempRows);

                    var tempGraphOptions = {
                      hAxis: {
                        title: 'Time (hrs:mins:sec)'
                      },
                      vAxis: {
                        title: 'Temperature (Fahrenheit)'
                      }
                    };

                    var tempchart = new google.visualization.LineChart(document.getElementById('temperature_chart_div'));
                    tempchart.draw(tempGraphData, tempGraphOptions);


                    var humidGraphData = new google.visualization.DataTable();
                    humidGraphData.addColumn('string', 'Time');
                    humidGraphData.addColumn('number', 'Humidity');

                    humidGraphData.addRows(humidRows);

                    var humidGraphOptions = {
                      hAxis: {
                        title: 'Time (hrs:mins:sec)'
                      },
                      vAxis: {
                        title: 'Humidity (%)'
                      }
                    };

                    var humidchart = new google.visualization.LineChart(document.getElementById('humidity_chart_div'));
                    humidchart.draw(humidGraphData, humidGraphOptions);
                }
            })

          })

          firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
              // User is signed in.
              document.getElementById("userId").innerHTML = 'Your UserId: ' + firebase.auth().currentUser.uid;
            } else {
              // No user is signed in.
            }
          });
    </script>

    </head>

    <body>
      <div id="userId"></div>
      <table class="columns" style="width:100%; table-layout:fixed;">
        <tr style="border: 1px solid #ccc">
          <span><h1 id="device_Name"></h1></span>
          <td>
            <span><h2 id="Current_Temperature"></h2></span>
            <div id="temperature_chart_div" style="border: 1px solid #ccc"></div>
          </td>
          <td>
            <span><h2 id="Current_Humidity"></h2></span>
            <div id="humidity_chart_div" style="border: 1px solid #ccc"></div></td>
        </tr>
        </table>
    </body>
  </html>
